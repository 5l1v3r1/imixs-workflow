<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:cc="http://java.sun.com/jsf/composite">

<cc:interface>
	<cc:attribute name="value" />
</cc:interface>

<cc:implementation>

<style>

</style>

	<h:form id="imixsfileuploadform" enctype="multipart/form-data">
		<script type="text/javascript">
		/*<![CDATA[*/
			$(document).ready(function() {
			    // hide sections if query param available
			    if (parent.top.imixsfileupload_hideattachments) {
			        $(this).find('table[id$=imixsfileuploadattachments]').hide();
			    }
			    if (parent.top.imixsfileupload_hideuploads) {
			        $(this).find('table[id$=imixsfileuploaduploads]').hide();
			    }

                // style buttons
				$("#selectnewfile").button({
					text : true,
					icons : {
						primary : "ui-icon-plusthick"
					}
				});
				$("[id$=clearbutton]").button({
					text : true,
					icons : {
						primary : "ui-icon-trash"
					}
				});

			});

			function autoupload() {
				$("[id$=uploadfileButton]").click();
			}

			// this functio opens the file select box form the fileInput 
			function selectNewFile() {
				$("[id$=FileUpload]").click();
			}
		/*]]>*/	
		</script>

		<div id="imixsfileuploadcontrol">
			<span> <a href="#" id="selectnewfile"
				onclick="selectNewFile();">Add file</a> <h:commandLink
					id="clearbutton" actionListener="#{fileUploadController.doClear}">Clear</h:commandLink>
			</span>
			<div id="imixsfileuploadcontent">
				<h:dataTable id="imixsfileuploaduploads" value="#{fileUploadController.uploadedFiles}" 
					var="file" class="imixsfileuploadtable">

					<h:column>
						<h:outputText value="#{file.name}">
						</h:outputText>
					</h:column>
					<h:column>
						<h:outputText value="#{file.contentType}">
						</h:outputText>
					</h:column>
					<h:column>
						<h:outputText value="#{file.size}">
						</h:outputText>
					</h:column>
				</h:dataTable>

				<!-- attached files -->
				<h:dataTable id="imixsfileuploadattachments" value="#{fileUploadController.attachedFiles}"
					var="attachment" class="imixsfileuploadtable">

					<h:column>
						<h:outputText escape="false" value="&lt;a target='_balnk' href='" />
						<h:outputText escape="false"
							value="#{fileUploadController.restServiceURI}#{fileUploadController.workitemID}/file/#{attachment}" />
						<h:outputText escape="false" value="'&gt;#{attachment}&lt;/a&gt;" />
					</h:column>

					<!--  Loeschen  -->
					<h:column>
						<h:commandLink title="#{global.delete}"
							action="#{fileUploadController.removeAttachmentAction(attachment)}">
							<h:graphicImage border="0" url="/layout/icons/remove.gif" />
						</h:commandLink>
					</h:column>

				</h:dataTable>
			</div>

			<!-- hidden control elements -->
			<div id="uploader"
				style="visibility: hidden; width: 0px; height: 0px;">
				<input type="file" name="imixsFileUpload" onchange="autoupload();"
					id="#{cc.clientId}:imixsFileUpload"
					style="height: 0px; width: 0px;" />
				<h:commandLink id="uploadfileButton" style="height:0px;width:0px;"
					actionListener="#{fileUploadController.doUpload}"
					value="doUpload file" />
			</div>
			<div style="clear: left;" />
		</div>
	</h:form>
</cc:implementation>



</html>


